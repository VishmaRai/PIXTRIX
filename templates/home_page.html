<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Cache-Control" content="no-store" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PIXTRIX - AI Image Generator</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='Logos/favicon.png') }}">
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tektur:wght@400..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home_page.css') }}">
  </head>
  <body>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- Matrix Rain Background -->
    <canvas id="matrix-canvas" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:-2;pointer-events:none;opacity: 0.5;"></canvas>
    <div class="scanlines"></div>

    <div class="container">
      <!-- Header Module -->
      <div class="header">
        <div class="logo glitch" data-text="PIXTRIX">PIXTRIX</div>
        <div class="user-info">
          <a href="/add_credits" class="add-credits-btn" id="addCreditsBtn">+</a>
          <div class="credit-count" id="creditCount">
            <i class="fas fa-bolt" style="margin-right: 10px;"></i>{% if active_sub and active_sub.credits_remaining is not none %}{{ active_sub.credits_remaining }}{% else %}{{ user.credits }}{% endif %}
            {% if active_sub %}
            <div class="credit-tooltip">
                <p class="tooltip-title"><b>{{ active_sub.plan_name }}</b> Plan</p>
                <p>Credits: {{ active_sub.credits_remaining }} / {{ active_sub.max_credits }}</p>
                <p>Expires: {{ active_sub.end_date.split(' ')[0] }}</p>
            </div>
            {% endif %}
          </div>
          <div class="profile-icon-wrapper">
            <div class="profile-icon" id="profileIcon">
              {{ session['initials'] }}
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content Grid -->
      <div class="main-content">
        <!-- Control Panel Module -->
        <div class="control-panel">
          <form method="post" id="imageForm">
            <textarea
              name="prompt"
              class="prompt-area"
              placeholder=" Describe your Image_"
              required
            ></textarea>

            <input
              type="hidden"
              name="aspect"
              id="aspectInput"
              value="square"
            />

            <div class="controls-row">
              <div class="aspect-select-container" id="aspectSelector">
                <div class="aspect-select-label">Aspect Ratio</div>
                <div class="aspect-select-value">▢ Square (1:1)</div>
                <div class="aspect-select-options">
                  <div class="aspect-option selected" data-value="square">
                    ▢ Square (1:1)
                  </div>
                  <div class="aspect-option" data-value="portrait">
                    ▯ Portrait (9:16)
                  </div>
                </div>
              </div>
              <button type="submit" class="generate-btn">
                <i class="fas fa-bolt" style="margin-right: 10px"></i> Generate
              </button>
            </div>
          </form>
        </div>

        <!-- Image Slots -->
        <div class="image-slot" id="slot1" style="border: 2px dashed rgba(0, 0, 255, 0.447);">
          <div class="image-placeholder">
            <i class="fas fa-question" style="margin-right: 10px;color: rgba(0, 0, 255, 0.273)"></i>
          </div>
          <div class="generation-overlay" style="display: none;" id="overlay1">
            <div class="matrix-rain-container" id="matrixRain1"></div>
            <div class="progress-info">
              <div class="hacker-loader">
                <div class="binary-ring"></div>
                <div class="core" style="box-shadow: 0 0 15px blue;"></div>
                <div class="binary-digits">
                  <span>0</span><span>1</span><span>0</span><span>1</span>
                  <span>0</span><span>1</span><span>0</span><span>1</span>
                </div>
                <div class="loading-text">GENERATING</div>
              </div>
            </div>
          </div>
        </div>
        <div class="image-slot" id="slot2" style="border: 2px dashed rgba(255, 0, 0, 0.49);">
          <div class="image-placeholder">
            <i class="fas fa-question" style="margin-right: 10px;color: rgba(255, 0, 0, 0.341)"></i>
          </div>
          <div class="generation-overlay" style="display: none;" id="overlay2">
            <div class="matrix-rain-container" id="matrixRain2"></div>
            <div class="progress-info">
              <div class="hacker-loader">
                <div class="binary-ring"></div>
                <div class="core" style="box-shadow: 0 0 15px #ff4400;"></div>
                <div class="binary-digits">
                  <span>0</span><span>1</span><span>0</span><span>1</span>
                  <span>0</span><span>1</span><span>0</span><span>1</span>
                </div>
                <div class="loading-text">GENERATING</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile Popup Modal -->
    <div class="profile-popup" id="profilePopup">
      <div class="popup-content">
        <div class="popup-header">
          <div class="popup-title glitch" data-text="PIXTRIX">PIXTRIX</div>
          <button class="close-btn" id="closeBtn">×</button>
        </div>
        <div class="user-info2">
          <div class="user-avatar">{{ session['initials'] }}</div>
          <div class="user-details">
            <h3>{{ session['username'] }}</h3>
            <p>{{ session['email'] }}</p>
          </div>
        </div>
        <div class="menu-options">
          <a href="/library" class="menu-item">
            <i class="fas fa-images"></i>
            <span>My Library</span>
          </a>
          <a href="/account" class="menu-item">
            <i class="fas fa-cog"></i>
            <span>Manage Account</span>
          </a>
          <!-- POST-only logout form -->
          <form action="{{ url_for('logout') }}" method="POST" >
            <button type="submit" class="menu-item logout"  >
              <i class="fas fa-sign-out-alt"></i>
              <span>Log Out</span>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- ── Manage Account Pop-up ----------------------------------- -->
<div class="account-popup" id="accountPopup">
  <div class="account-popup-content">
    <div class="account-popup-header">
      <span class="glitch" data-text="MANAGE ACCOUNT">MANAGE ACCOUNT</span>
      <button class="close-account-btn" id="closeAccountBtn">&times;</button>
    </div>

    <form id="changeUsernameForm" class="account-form">
      <label>Change Username</label>
      <input type="text" id="newUsername" maxlength="30" required
             placeholder="New username"/>
      <button type="submit">Save</button>
    </form>

    <hr class="divider">

    <button id="deleteAccountBtn" class="danger-btn">
      <i class="fas fa-trash-alt"></i> Delete Account
    </button>
  </div>
</div>

    <div class="gallery-link-container">
      <a href="/gallery_all">
        <img src="{{ url_for('static', filename='Logos/Rick and morty.gif') }}" alt="PIXTRIX Gallery" class="gallery-icon">
        <span class="gallery-text" data-text="PIXTRIX Gallery">PIXTRIX Gallery</span>
      </a>
    </div>

    <!-- Custom Modal -->
    <div class="custom-modal-overlay" id="customModalOverlay">
      <div class="custom-modal-content">
        <div class="custom-modal-header">
          <span class="glitch" data-text="SYSTEM ALERT" id="customModalTitle">SYSTEM ALERT</span>
        </div>
        <div class="custom-modal-body">
          <p id="customModalMessage"></p>
        </div>
        <div class="custom-modal-footer" id="customModalFooter">
          <button id="customModalConfirmBtn">CONFIRM</button>
          <button id="customModalCancelBtn">CANCEL</button>
        </div>
      </div>
    </div>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/home_page.js') }}"></script>
  </body>
</html>